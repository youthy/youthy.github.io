<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">





    <link rel="dns-prefetch" href="https://youthyblog.disqus.com"/>



    <link rel="dns-prefetch" href="https://hm.baidu.com"/>

    <link rel="dns-prefetch" href="https://www.google-analytics.com"/>



    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            erlang_mysql_driver源码分析(三) | 
        
        youthy的流水账
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="
#mysql_recv:start_link
12345init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&amp;gt;    case mysql_recv:start_link(Host, Port, LogFun, self()) of	&amp;#123;ok, RecvPid, Sock&amp;#125; -&amp;gt;	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of		&amp;#123;ok, Version&amp;#125; -&amp;gt;
上次在mysql_conn:init里面调用了mysql_recv:start_link,我们知道返回一个RecvPid接收进程的Pid和Sock套接字。mysql_recv:start_link过程如下">
    <meta name="keywords" content="erlang, golang,erlang">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: ;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="youthy的流水账">
    <meta name="msapplication-starturl" content="http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="youthy的流水账">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    <meta name="google-site-verification" content="luyN6dELjQn-N4acL35Kyqd_3xEjr8gA3TqpaSV23kk" />
    <meta name="baidu-site-verification" content="BA4RKG2m6D" />

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="erlang_mysql_driver源码分析(三) | youthy的流水账">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="
#mysql_recv:start_link
12345init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&amp;gt;    case mysql_recv:start_link(Host, Port, LogFun, self()) of	&amp;#123;ok, RecvPid, Sock&amp;#125; -&amp;gt;	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of		&amp;#123;ok, Version&amp;#125; -&amp;gt;
上次在mysql_conn:init里面调用了mysql_recv:start_link,我们知道返回一个RecvPid接收进程的Pid和Sock套接字。mysql_recv:start_link过程如下">
    <meta property="og:article:tag" content="erlang"> 

    
        <meta property="article:published_time" content="Wed Jun 10 2015 15:37:35 GMT+0800">
        <meta property="article:modified_time" content="Wed Oct 17 2018 16:46:23 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html",
    "headline": "erlang_mysql_driver源码分析(三)",
    "datePublished": "Wed Jun 10 2015 15:37:35 GMT+0800",
    "dateModified": "Wed Oct 17 2018 16:46:23 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Youthy",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "youthy的流水账",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",erlangerlang, golang",
    "description": "
#mysql_recv:start_link
12345init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&amp;gt;    case mysql_recv:start_link(Host, Port, LogFun, self()) of	&amp;#123;ok, RecvPid, Sock&amp;#125; -&amp;gt;	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of		&amp;#123;ok, Version&amp;#125; -&amp;gt;
上次在mysql_conn:init里面调用了mysql_recv:start_link,我们知道返回一个RecvPid接收进程的Pid和Sock套接字。mysql_recv:start_link过程如下",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-127668650-1', 'auto');ga('send', 'pageview');
</script>
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?d4026e5060b2e4c5254eaeca317f90bd';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                erlang_mysql_driver源码分析(三)
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Youthy</strong>
        <span>6月 10, 2015</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/erlang/">erlang</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=erlang_mysql_driver源码分析(三)&url=http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html&pic=http://youthyblog.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=erlang_mysql_driver源码分析(三)&url=http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html&via=Youthy" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <!-- toc -->
<p>#mysql_recv:start_link</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&gt;</span><br><span class="line">    case mysql_recv:start_link(Host, Port, LogFun, self()) of</span><br><span class="line">	&#123;ok, RecvPid, Sock&#125; -&gt;</span><br><span class="line">	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of</span><br><span class="line">		&#123;ok, Version&#125; -&gt;</span><br></pre></td></tr></table></figure>
<p>上次在mysql_conn:init里面调用了mysql_recv:start_link,我们知道返回一个RecvPid接收进程的Pid和Sock套接字。mysql_recv:start_link过程如下<br><a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">start_link(Host, Port, LogFun, Parent) when is_list(Host), is_integer(Port) -&gt;</span><br><span class="line">    RecvPid =</span><br><span class="line">	spawn_link(fun () -&gt;</span><br><span class="line">			   init(Host, Port, LogFun, Parent)</span><br><span class="line">		   end),</span><br><span class="line">    %% wait for the socket from the spawned pid</span><br><span class="line">    receive</span><br><span class="line">	&#123;mysql_recv, RecvPid, init, &#123;error, E&#125;&#125; -&gt;</span><br><span class="line">	    &#123;error, E&#125;;</span><br><span class="line">	&#123;mysql_recv, RecvPid, init, &#123;ok, Socket&#125;&#125; -&gt;</span><br><span class="line">	    &#123;ok, RecvPid, Socket&#125;</span><br><span class="line">    after ?CONNECT_TIMEOUT -&gt;</span><br><span class="line">	    catch exit(RecvPid, kill),</span><br><span class="line">	    &#123;error, &quot;timeout&quot;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure>
<p>与mysql_conn大体相同，同样spawn一个进程，将mysql_conn的Pid传入当做Parent父进程，然后mysql_conn等待receive消息，如果spawn的mysql_recv进程返回{mysql_recv, RecvPid, init, {ok, Socket}},就代表创建成功，然后将RecvPid, Socket这些有用的变量返回，以便于mysql_init进行,<br>如果超过?CONNECT_TIMEOUT的时间，则会调用exit(RecvPid, kill)关闭mysql_recv进程，并返回{error, “timeout”}.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">init(Host, Port, LogFun, Parent) -&gt;</span><br><span class="line">    case gen_tcp:connect(Host, Port, [binary, &#123;packet, 0&#125;]) of</span><br><span class="line">	&#123;ok, Sock&#125; -&gt;</span><br><span class="line">	    Parent ! &#123;mysql_recv, self(), init, &#123;ok, Sock&#125;&#125;,</span><br><span class="line">	    State = #state&#123;socket  = Sock,</span><br><span class="line">			   parent  = Parent,</span><br><span class="line">			   log_fun = LogFun,</span><br><span class="line">			   data    = &lt;&lt;&gt;&gt;</span><br><span class="line">			  &#125;,</span><br><span class="line">	    loop(State);</span><br><span class="line">	E -&gt;</span><br><span class="line">	    LogFun(?MODULE, ?LINE, error,</span><br><span class="line">		   fun() -&gt;</span><br><span class="line">			   &#123;&quot;mysql_recv: Failed connecting to ~p:~p : ~p&quot;,</span><br><span class="line">			    [Host, Port, E]&#125;</span><br><span class="line">		   end),</span><br><span class="line">	    Msg = lists:flatten(io_lib:format(&quot;connect failed : ~p&quot;, [E])),</span><br><span class="line">	    Parent ! &#123;mysql_recv, self(), init, &#123;error, Msg&#125;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure>
<p>init里面通过gen_tcp:connect连接了端口，返回套接字，将这个套接字发送给父进程也就是在上面receive的地方，之后进入loop。如果连接失败，打印错误，并通知父进程。</p>
<blockquote>
<p>state{socket,   %套接字<br>        parent,   %父进程pid<br>        log_fun,  %打印日志函数<br>        data,     %端口发来的数据<br>}</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">loop(State) -&gt;</span><br><span class="line">    Sock = State#state.socket,</span><br><span class="line">    receive</span><br><span class="line">	&#123;tcp, Sock, InData&#125; -&gt;</span><br><span class="line">	    NewData = list_to_binary([State#state.data, InData]),</span><br><span class="line">	    %% send data to parent if we have enough data</span><br><span class="line">	    Rest = sendpacket(State#state.parent, NewData),</span><br><span class="line">	    loop(State#state&#123;data = Rest&#125;);</span><br><span class="line">	&#123;tcp_error, Sock, Reason&#125; -&gt;</span><br><span class="line">	    LogFun = State#state.log_fun,</span><br><span class="line">	    LogFun(?MODULE, ?LINE, error,</span><br><span class="line">		   fun() -&gt;</span><br><span class="line">			   &#123;&quot;mysql_recv: Socket ~p closed : ~p&quot;,</span><br><span class="line">			    [Sock, Reason]&#125;</span><br><span class="line">		   end),</span><br><span class="line">	    State#state.parent ! &#123;mysql_recv, self(), closed, &#123;error, Reason&#125;&#125;,</span><br><span class="line">	    error;</span><br><span class="line">	&#123;tcp_closed, Sock&#125; -&gt;</span><br><span class="line">	    LogFun = State#state.log_fun,</span><br><span class="line">	    LogFun(?MODULE, ?LINE, debug,</span><br><span class="line">		   fun() -&gt;</span><br><span class="line">			   &#123;&quot;mysql_recv: Socket ~p closed&quot;, [Sock]&#125;</span><br><span class="line">		   end),</span><br><span class="line">	    State#state.parent ! &#123;mysql_recv, self(), closed, normal&#125;,</span><br><span class="line">	    error</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure>
<p>gen_tcp:connect没有指定{active, false},这样的话，端口可以主动发给recv进程消息。实际上在在gen_tcp:connect之后我们得到Socket的同时，mysql_recv进程的消息队列里已经有Socket的发来的消息了。我们在shell里面可以试一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1&gt; gen_tcp:connect(&quot;localhost&quot;, 3306, [binary, &#123;packet, 0&#125;]).</span><br><span class="line">&#123;ok,#Port&lt;0.595&gt;&#125;</span><br><span class="line">2&gt; rp(process_info(self())).</span><br><span class="line">[&#123;current_function,&#123;erl_eval,do_apply,6&#125;&#125;,</span><br><span class="line"> &#123;initial_call,&#123;erlang,apply,2&#125;&#125;,</span><br><span class="line"> &#123;status,running&#125;,</span><br><span class="line"> &#123;message_queue_len,2&#125;,</span><br><span class="line"> &#123;messages,[&#123;tcp,#Port&lt;0.595&gt;,</span><br><span class="line">                 &lt;&lt;91,0,0,0,10,53,46,53,46,51,55,45,48,117,98,117,110,116,</span><br><span class="line">                   117,48,46,49,52,46,48,52,46,49,0,187,1,0,0,57,98,97,67,</span><br><span class="line">                   104,98,52,123,0,255,247,8,2,0,15,128,21,0,0,0,0,0,0,0,</span><br><span class="line">                   0,0,0,50,36,92,38,67,96,59,67,125,112,59,115,0,109,121,</span><br><span class="line">                   115,113,108,95,110,97,116,105,118,101,95,112,97,115,</span><br><span class="line">                   115,119,111,114,100,0&gt;&gt;&#125;,</span><br><span class="line">            &#123;tcp_closed,#Port&lt;0.595&gt;&#125;]&#125;,</span><br><span class="line"> &#123;links,[&lt;0.26.0&gt;]&#125;,</span><br><span class="line"> &#123;dictionary,[]&#125;,</span><br><span class="line"> &#123;trap_exit,false&#125;,</span><br><span class="line"> &#123;error_handler,error_handler&#125;,</span><br><span class="line"> &#123;priority,normal&#125;,</span><br><span class="line"> &#123;group_leader,&lt;0.25.0&gt;&#125;,</span><br><span class="line"> &#123;total_heap_size,3571&#125;,</span><br><span class="line"> &#123;heap_size,987&#125;,</span><br><span class="line"> &#123;stack_size,37&#125;,</span><br><span class="line"> &#123;reductions,4070&#125;,</span><br><span class="line"> &#123;garbage_collection,[&#123;min_bin_vheap_size,46368&#125;,</span><br><span class="line">                      &#123;min_heap_size,233&#125;,</span><br><span class="line">                      &#123;fullsweep_after,65535&#125;,</span><br><span class="line">                      &#123;minor_gcs,5&#125;]&#125;,</span><br><span class="line"> &#123;suspending,[]&#125;]</span><br><span class="line">ok</span><br></pre></td></tr></table></figure></p>
<p>我们所做的操作以mysql_recv:init里面是一样的。打开了3306端口。这是shell的messagebox里面已经有了两天Socket发来的消息。loop函数将这段消息交给了sendpacket处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sendpacket(Parent, Data) -&gt;</span><br><span class="line">    case Data of</span><br><span class="line">	&lt;&lt;Length:24/little, Num:8, D/binary&gt;&gt; -&gt;</span><br><span class="line">	    if</span><br><span class="line">		Length =&lt; size(D) -&gt;</span><br><span class="line">		    &#123;Packet, Rest&#125; = split_binary(D, Length),</span><br><span class="line">		    Parent ! &#123;mysql_recv, self(), data, Packet, Num&#125;,</span><br><span class="line">		    sendpacket(Parent, Rest);</span><br><span class="line">		true -&gt;</span><br><span class="line">		    Data</span><br><span class="line">	    end;</span><br><span class="line">	_ -&gt;</span><br><span class="line">	    Data</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure>
<p>packet头3个字节表示数据长度，第四个字节是帧序号，之后所有的是数据。那么这段数据头三个&lt;&lt;91,0,0&gt;&gt;代表数据长度是91字节（小端存储），之后的0代表这个帧序号是0，&lt;&lt;10….&gt;&gt;就是真正的数据。sendpacket将这段数据发给了parent。在如下的地方匹配<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&gt;</span><br><span class="line">    case mysql_recv:start_link(Host, Port, LogFun, self()) of</span><br><span class="line">	&#123;ok, RecvPid, Sock&#125; -&gt;</span><br><span class="line">	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of</span><br><span class="line">		&#123;ok, Version&#125; -&gt;</span><br><span class="line">------</span><br><span class="line">mysql_init(Sock, RecvPid, User, Password, LogFun) -&gt;</span><br><span class="line">    case do_recv(LogFun, RecvPid, undefined) of</span><br><span class="line">	&#123;ok, Packet, InitSeqNum&#125; -&gt;</span><br><span class="line">		    &#123;Version, Salt1, Salt2, Caps&#125; = greeting(Packet, LogFun),</span><br><span class="line">-----</span><br><span class="line">do_recv(LogFun, RecvPid, SeqNum)  when is_function(LogFun);</span><br><span class="line">				       LogFun == undefined,</span><br><span class="line">				       SeqNum == undefined -&gt;</span><br><span class="line">    receive</span><br><span class="line">        &#123;mysql_recv, RecvPid, data, Packet, Num&#125; -&gt;</span><br><span class="line">	    &#123;ok, Packet, Num&#125;;</span><br><span class="line">	&#123;mysql_recv, RecvPid, closed, _E&#125; -&gt;</span><br><span class="line">	    &#123;error, &quot;mysql_recv: socket was closed&quot;&#125;</span><br><span class="line">    end;</span><br></pre></td></tr></table></figure></p>
<p>在mysql_conn的do_recv完成对消息的匹配。<br>上面的数据其实就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">=INFO REPORT==== 10-Jun-2015::11:59:21 ===</span><br><span class="line">I(&lt;0.116.0&gt;:mysql_conn:620) : greeting packet &lt;&lt;10,53,46,53,46,51,55,45,48,117,</span><br><span class="line">                                                98,117,110,116,117,48,46,49,52,</span><br><span class="line">                                                46,48,52,46,49,0,173,1,0,0,100,</span><br><span class="line">                                                44,77,124,75,63,60,78,0,255,</span><br><span class="line">                                                247,8,2,0,15,128,21,0,0,0,0,0,</span><br><span class="line">                                                0,0,0,0,0,84,60,110,54,95,93,</span><br><span class="line">                                                55,57,88,46,122,66,0,109,121,</span><br><span class="line">                                                115,113,108,95,110,97,116,105,</span><br><span class="line">                                                118,101,95,112,97,115,115,119,</span><br><span class="line">                                                111,114,100,0&gt;&gt; version &quot;5.5.37-0ubuntu0.14.04.1&quot; (protocol 10) salt &quot;d,M|K?&lt;N&quot; caps 63487 serverchar &lt;&lt;8,2,0,</span><br><span class="line">                                                                                                                                                        15,128,</span><br><span class="line">                                                                                                                                                        21,0,0,</span><br><span class="line">                                                                                                                                                        0,0,0,0,</span><br><span class="line">                                                                                                                                                        0,0,0,0&gt;&gt;salt2 &quot;T&lt;n6_]79X.zB&quot;</span><br></pre></td></tr></table></figure></p>
<p>greeting函数用来转化为版本号，salt等参数的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">greeting(Packet, LogFun) -&gt;</span><br><span class="line">    &lt;&lt;Protocol:8, Rest/binary&gt;&gt; = Packet,</span><br><span class="line">    &#123;Version, Rest2&#125; = asciz(Rest),</span><br><span class="line">    &lt;&lt;_TreadID:32/little, Rest3/binary&gt;&gt; = Rest2,</span><br><span class="line">    &#123;Salt, Rest4&#125; = asciz(Rest3),</span><br><span class="line">    &lt;&lt;Caps:16/little, Rest5/binary&gt;&gt; = Rest4,</span><br><span class="line">    &lt;&lt;ServerChar:16/binary-unit:8, Rest6/binary&gt;&gt; = Rest5,</span><br><span class="line">    &#123;Salt2, _Rest7&#125; = asciz(Rest6),</span><br><span class="line">    ?Log2(LogFun, debug,</span><br><span class="line">	  &quot;greeting packet ~p version ~p (protocol ~p) salt ~p caps ~p serverchar ~p&quot;</span><br><span class="line">	  &quot;salt2 ~p&quot;,</span><br><span class="line">	  [Packet, Version, Protocol, Salt, Caps, ServerChar, Salt2]),</span><br><span class="line">    &#123;normalize_version(Version, LogFun), Salt, Salt2, Caps&#125;.</span><br><span class="line">------------------------------------------</span><br><span class="line">asciz(Data) when is_binary(Data) -&gt;</span><br><span class="line">    mysql:asciz_binary(Data, []).</span><br><span class="line">-----------------------------------------</span><br><span class="line">asciz_binary(&lt;&lt;&gt;&gt;, Acc) -&gt;</span><br><span class="line">    &#123;lists:reverse(Acc), &lt;&lt;&gt;&gt;&#125;;</span><br><span class="line">asciz_binary(&lt;&lt;0:8, Rest/binary&gt;&gt;, Acc) -&gt;</span><br><span class="line">    &#123;lists:reverse(Acc), Rest&#125;;</span><br><span class="line">asciz_binary(&lt;&lt;C:8, Rest/binary&gt;&gt;, Acc) -&gt;</span><br><span class="line">    asciz_binary(Rest, [C | Acc]).</span><br></pre></td></tr></table></figure></p>
<p>Packet第一个字节是protocol,之后asciz函数将剩下的二进制以0位分界点分开。那么<br>Packet被分成了</p>
<blockquote>
<p>Protocol : &lt;<10>&gt;<br>Version:&lt;&lt;53,46,53,46,51,55,45,48,117,98,117,110,116,117,48,46,49,52,46,48,52,46,49&gt;&gt;,<br>Salt:&lt;&lt;100,44,77,124,75,63,60,78&gt;&gt;<br>Caps:&lt;&lt;255,247&gt;&gt;<br>ServerChar:&lt;&lt;15,128,21,0,0,0,0,0,0,0,0,0,0,84,60,110&gt;&gt;(ServerChar是16个字节不是16个bit)<br>Salt2:&lt;&lt;97,116,105,118,101,95,112,97,115,115,119,111,114,100&gt;&gt;</10></p>
</blockquote>
<p>在shell中检测下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">4&gt; &lt;&lt;53,46,53,46,51,55,45,48,117,98,117,110,116,117,48,46,49,52,46,48,52,46,49&gt;&gt;.</span><br><span class="line">&lt;&lt;&quot;5.5.37-0ubuntu0.14.04.1&quot;&gt;&gt;</span><br><span class="line">5&gt; &lt;&lt;100,44,77,124,75,63,60,78&gt;&gt;.</span><br><span class="line">&lt;&lt;&quot;d,M|K?&lt;N&quot;&gt;&gt;</span><br><span class="line">6&gt; &lt;&lt;Caps:16/little&gt;&gt; = &lt;&lt;255,247&gt;&gt;.</span><br><span class="line">&lt;&lt;&quot;ÿ÷&quot;&gt;&gt;</span><br><span class="line">7&gt; Caps.</span><br><span class="line">63487</span><br></pre></td></tr></table></figure></p>
<p>和上面打印的log是一样的。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://youthyblog.com/2015/06/10/erlang_mysql_driver源码分析(三)/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//youthyblog.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2015/06/15/关于hexo的toc/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/06/09/erlang_mysql_driver源码分析(二)/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Youthy's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        Contact
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://weibo.com/u/1592381215" target="_blank" title="Weibo me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">person_add</i>
                        
                        Weibo me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/10/">十月 2014<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/09/">九月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/08/">八月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/07/">七月 2014<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/06/">六月 2014<span class="sidebar_archives-count">6</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/ACG/">ACG<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/erlang/">erlang<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/hexo/">hexo<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                Links
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/shizixiuluo" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="https://weibo.com/1592381215" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/yu-you-qi-46/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-zhihu">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;youthy的流水账
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//youthyblog.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?[object Object]');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2014;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
