<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">





    <link rel="dns-prefetch" href="https://youthyblog.disqus.com"/>



    <link rel="dns-prefetch" href="https://hm.baidu.com"/>

    <link rel="dns-prefetch" href="https://www.google-analytics.com"/>



    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            erlang_mysql_driver　源码分析(二) | 
        
        youthy的流水账
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="#mysql_conn:start回到mysql:start_link这个最开始这个地方
1234LogFun1 = if LogFun == undefined -&amp;gt; fun log/4; true -&amp;gt; LogFun end,   case mysql_conn:start(Host, Port, User, Password, Database, LogFun1,		  Encoding, PoolId) of&amp;#123;ok, ConnPid&amp;#125; -&amp;gt;">
    <meta name="keywords" content="erlang, golang,erlang">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body {
        background-color: ;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text {
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="youthy的流水账">
    <meta name="msapplication-starturl" content="http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="youthy的流水账">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    <meta name="google-site-verification" content="luyN6dELjQn-N4acL35Kyqd_3xEjr8gA3TqpaSV23kk" />
    <meta name="baidu-site-verification" content="BA4RKG2m6D" />

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="erlang_mysql_driver　源码分析(二) | youthy的流水账">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="#mysql_conn:start回到mysql:start_link这个最开始这个地方
1234LogFun1 = if LogFun == undefined -&amp;gt; fun log/4; true -&amp;gt; LogFun end,   case mysql_conn:start(Host, Port, User, Password, Database, LogFun1,		  Encoding, PoolId) of&amp;#123;ok, ConnPid&amp;#125; -&amp;gt;">
    <meta property="og:article:tag" content="erlang"> 

    
        <meta property="article:published_time" content="Tue Jun 09 2015 17:21:15 GMT+0800">
        <meta property="article:modified_time" content="Wed Oct 17 2018 16:46:23 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html",
    "headline": "erlang_mysql_driver　源码分析(二)",
    "datePublished": "Tue Jun 09 2015 17:21:15 GMT+0800",
    "dateModified": "Wed Oct 17 2018 16:46:23 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Youthy",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Hi, nice to meet you"
    },
    "publisher": {
        "@type": "Organization",
        "name": "youthy的流水账",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",erlangerlang, golang",
    "description": "#mysql_conn:start回到mysql:start_link这个最开始这个地方
1234LogFun1 = if LogFun == undefined -&amp;gt; fun log/4; true -&amp;gt; LogFun end,   case mysql_conn:start(Host, Port, User, Password, Database, LogFun1,		  Encoding, PoolId) of&amp;#123;ok, ConnPid&amp;#125; -&amp;gt;",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-127668650-1', 'auto');ga('send', 'pageview');
</script>
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?d4026e5060b2e4c5254eaeca317f90bd';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                erlang_mysql_driver　源码分析(二)
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Youthy</strong>
        <span>6月 09, 2015</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/erlang/">erlang</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=erlang_mysql_driver　源码分析(二)&url=http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html&pic=http://youthyblog.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=erlang_mysql_driver　源码分析(二)&url=http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html&via=Youthy" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>#mysql_conn:start<br>回到mysql:start_link这个最开始这个地方</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LogFun1 = if LogFun == undefined -&gt; fun log/4; true -&gt; LogFun end,</span><br><span class="line">   case mysql_conn:start(Host, Port, User, Password, Database, LogFun1,</span><br><span class="line">		  Encoding, PoolId) of</span><br><span class="line">&#123;ok, ConnPid&#125; -&gt;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>起初为了不断开gen_server的创建，我们没有进入mysql_conn里面。现在可以进去一窥究竟啦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">start(Host, Port, User, Password, Database, LogFun, Encoding, PoolId) -&gt;</span><br><span class="line">    ConnPid = self(),</span><br><span class="line">    Pid = spawn(fun () -&gt;</span><br><span class="line">			init(Host, Port, User, Password, Database,</span><br><span class="line">			     LogFun, Encoding, PoolId, ConnPid)</span><br><span class="line">		end),</span><br><span class="line">    post_start(Pid, LogFun).</span><br><span class="line">    --------------------</span><br><span class="line">post_start(Pid, LogFun) -&gt;</span><br><span class="line">    receive</span><br><span class="line">	&#123;mysql_conn, Pid, ok&#125; -&gt;</span><br><span class="line">	    &#123;ok, Pid&#125;;</span><br><span class="line">	&#123;mysql_conn, Pid, &#123;error, Reason&#125;&#125; -&gt;</span><br><span class="line">	    &#123;error, Reason&#125;;</span><br><span class="line">	Unknown -&gt;</span><br><span class="line">	    ?Log2(LogFun, error,</span><br><span class="line">		 &quot;received unknown signal, exiting: ~p&quot;, [Unknown]),</span><br><span class="line">	    &#123;error, &quot;unknown signal received&quot;&#125;</span><br><span class="line">    after 5000 -&gt;</span><br><span class="line">	    &#123;error, &quot;timed out&quot;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>这里作者将post_start抽出来了，因为与start类似还有个start_link也需要这块代码，但是值得注意的是<br>post_start里面的receive仍然是由mysql:start_link生成的my_sql_game这个gen_server 在调用，而且<code>ConnPid = self()</code>这句代码很有歧义，因为这个ConnPid与mysql中的<code>{ok, ConnPid}</code>明显不是同一个意思。这里的ConnPid实际就是gen_server的Pid，用来传给init作为父进程参数，在子进程可以给父进程发消息,我觉得把这段post_start放到mysql中更容易理解一点。<br>这里我们可以看出来，start函数spawn一个mysql_conn:init这个进程，然后等待消息，如果成功的话，会返回{ok, Pid}，这个Pid是真正意义的ConnPid，用来生成#conn加入my_sql_game的#state里面的。其他情况会返回{error, Reason}.<br>然后看一下init<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">init(Host, Port, User, Password, Database, LogFun, Encoding, PoolId, Parent) -&gt;</span><br><span class="line">    case mysql_recv:start_link(Host, Port, LogFun, self()) of</span><br><span class="line">	&#123;ok, RecvPid, Sock&#125; -&gt;</span><br><span class="line">	    case mysql_init(Sock, RecvPid, User, Password, LogFun) of</span><br><span class="line">		&#123;ok, Version&#125; -&gt;</span><br><span class="line">		    Db = iolist_to_binary(Database),</span><br><span class="line">		    case do_query(Sock, RecvPid, LogFun,</span><br><span class="line">				  &lt;&lt;&quot;use &quot;, Db/binary&gt;&gt;,</span><br><span class="line">				  Version) of</span><br><span class="line">			&#123;error, MySQLRes&#125; -&gt;</span><br><span class="line">			    ?Log2(LogFun, error,</span><br><span class="line">				 &quot;mysql_conn: Failed changing to database &quot;</span><br><span class="line">				 &quot;~p : ~p&quot;,</span><br><span class="line">				 [Database,</span><br><span class="line">				  mysql:get_result_reason(MySQLRes)]),</span><br><span class="line">			    Parent ! &#123;mysql_conn, self(),</span><br><span class="line">				      &#123;error, failed_changing_database&#125;&#125;;</span><br><span class="line"></span><br><span class="line">			%% ResultType: data | updated</span><br><span class="line">			&#123;_ResultType, _MySQLRes&#125; -&gt;</span><br><span class="line">			    Parent ! &#123;mysql_conn, self(), ok&#125;,</span><br><span class="line">			    case Encoding of</span><br><span class="line">				undefined -&gt; undefined;</span><br><span class="line">				_ -&gt;</span><br><span class="line">				    EncodingBinary = list_to_binary(atom_to_list(Encoding)),</span><br><span class="line">				    do_query(Sock, RecvPid, LogFun,</span><br><span class="line">					     &lt;&lt;&quot;set names &apos;&quot;, EncodingBinary/binary, &quot;&apos;&quot;&gt;&gt;,</span><br><span class="line">					     Version)</span><br><span class="line">			    end,</span><br><span class="line">			    State = #state&#123;mysql_version=Version,</span><br><span class="line">					   recv_pid = RecvPid,</span><br><span class="line">					   socket   = Sock,</span><br><span class="line">					   log_fun  = LogFun,</span><br><span class="line">					   pool_id  = PoolId,</span><br><span class="line">					   data     = &lt;&lt;&gt;&gt;</span><br><span class="line">					  &#125;,</span><br><span class="line">			    loop(State)</span><br><span class="line">		    end;</span><br><span class="line">		&#123;error, _Reason&#125; -&gt;</span><br><span class="line">		    Parent ! &#123;mysql_conn, self(), &#123;error, login_failed&#125;&#125;</span><br><span class="line">	    end;</span><br><span class="line">	E -&gt;</span><br><span class="line">	    ?Log2(LogFun, error,</span><br><span class="line">		 &quot;failed connecting to ~p:~p : ~p&quot;,</span><br><span class="line">		 [Host, Port, E]),</span><br><span class="line">	    Parent ! &#123;mysql_conn, self(), &#123;error, connect_failed&#125;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>这个init比较长，而且里面又调了mysql_recv:start_link，之前之所以没有直接分析这里面也是这个原因，在start_link里面重复调用各个模块的start_link很容易绕进去。<br>同样，我们根据case语句，知道mysql_recv:start_link建了一个新的进程，并且返回RecvPid和一个Sock，可知创建进程的同时监听了某个端口。如果没有成功会返回{error， Reason}</p>
<p>之后进入mysql_init函数。我们先不要进入mysql_init，这个函数完成了用户名和密码的认证，认证成功会返回{ok, Version}</p>
<p>接下来要做的是<br><code>case do_query(Sock, RecvPid, LogFun,
                  &lt;&lt;&quot;use &quot;, Db/binary&gt;&gt;,
                  Version) of</code><br>通知端口我们要使用哪个数据库，打印出来是这段文字<br><code>fetch &lt;&lt;&quot;use aries_game&quot;&gt;&gt;</code><br>返回结果{error, MysqlRes}或者{ResultType, MysqlRes}.<br>MysqlRes是一个record</p>
<blockquote>
<p>-record(mysql_result,<br>    {fieldinfo=[],<br>     rows=[],<br>     affectedrows=0,<br>     error=””}).</p>
</blockquote>
<p>在do_query的里面，将端口返回来的结果构造成#mysql_result的样子，他包含了需要的rows，或者操作所影响的affetedrows，fieldinfo以及如果出错的错误信息error.<br>如果返回{error, MysqlRes}, 我们调用接口mysql:get_result_reason(MysqlRes)获取错误原因。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_result_reason(#mysql_result&#123;error=Reason&#125;) -&gt;</span><br><span class="line">    Reason.</span><br></pre></td></tr></table></figure></p>
<p>并通知父进程出错了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Parent ! &#123;mysql_conn, self(), &#123;error, failed_changing_database&#125;&#125;;</span><br></pre></td></tr></table></figure></p>
<p>相反<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;_ResultType, _MySQLRes&#125; -&gt;</span><br><span class="line">			    Parent ! &#123;mysql_conn, self(), ok&#125;,</span><br></pre></td></tr></table></figure></p>
<p>如果没有出错，我们就告诉父进程ok。<br>还记得post_start里面的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">post_start(Pid, LogFun) -&gt;</span><br><span class="line">    receive</span><br><span class="line">	&#123;mysql_conn, Pid, ok&#125; -&gt;</span><br><span class="line">	    &#123;ok, Pid&#125;;</span><br><span class="line">	&#123;mysql_conn, Pid, &#123;error, Reason&#125;&#125; -&gt;</span><br><span class="line">	    &#123;error, Reason&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这就是receive我们这些消息的地方。<br>后面的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EncodingBinary = list_to_binary(atom_to_list(Encoding)),</span><br><span class="line">		    do_query(Sock, RecvPid, LogFun,</span><br><span class="line">			     &lt;&lt;&quot;set names &apos;&quot;, EncodingBinary/binary, &quot;&apos;&quot;&gt;&gt;,</span><br><span class="line">			     Version)</span><br></pre></td></tr></table></figure></p>
<p>用来设定我们的编码方式，目前用的utf8.<br>下面了解下do_query的细节，因为之后我们要做的查询，插入等操作也经过它<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">do_query(Sock, RecvPid, LogFun, Query, Version) -&gt;</span><br><span class="line">    Query1 = iolist_to_binary(Query),</span><br><span class="line">    ?Log2(LogFun, debug, &quot;fetch ~p (id ~p)&quot;, [Query1,RecvPid]),</span><br><span class="line">    Packet =  &lt;&lt;?MYSQL_QUERY_OP, Query1/binary&gt;&gt;,</span><br><span class="line">    case do_send(Sock, Packet, 0, LogFun) of</span><br><span class="line">	ok -&gt;</span><br><span class="line">	    get_query_response(LogFun,RecvPid,</span><br><span class="line">				    Version);</span><br><span class="line">	&#123;error, Reason&#125; -&gt;</span><br><span class="line">	    Msg = io_lib:format(&quot;Failed sending data &quot;</span><br><span class="line">				&quot;on socket : ~p&quot;,</span><br><span class="line">				[Reason]),</span><br><span class="line">	    &#123;error, Msg&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>Query是我们的sql语句，比如上面的&lt;&lt;&lt;”use aries_game”&gt;&gt;,<br>Query1使我们给Query加上一个字节的3(?MYSQL_QUERY_OP是3）.<br>do_send将packet打包并发送，头三个字节是packet大小，第4个字节是序列号，之后是packet内容，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">do_send(Sock, Packet, SeqNum, _LogFun) when is_binary(Packet), is_integer(SeqNum) -&gt;</span><br><span class="line">    Data = &lt;&lt;(size(Packet)):24/little, SeqNum:8, Packet/binary&gt;&gt;,</span><br><span class="line">    gen_tcp:send(Sock, Data).</span><br></pre></td></tr></table></figure></p>
<p>这时候向端口发送了请求,get_query_response等待回应。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">get_query_response(LogFun, RecvPid, Version) -&gt;</span><br><span class="line">    case do_recv(LogFun, RecvPid, undefined) of</span><br><span class="line">	&#123;ok, &lt;&lt;Fieldcount:8, Rest/binary&gt;&gt;, _&#125; -&gt;</span><br><span class="line">	    case Fieldcount of</span><br><span class="line">		0 -&gt;</span><br><span class="line">		    %% No Tabular data</span><br><span class="line">            &lt;&lt;AffectedRows:8, _Rest2/binary&gt;&gt; = Rest,</span><br><span class="line">            ?Log2(LogFun, debug, &quot;updated ~p&quot;, [AffectedRows]),</span><br><span class="line">		    &#123;updated, #mysql_result&#123;affectedrows=AffectedRows&#125;&#125;;</span><br><span class="line">		255 -&gt;</span><br><span class="line">		    &lt;&lt;_Code:16/little, Message/binary&gt;&gt;  = Rest,</span><br><span class="line">		    &#123;error, #mysql_result&#123;error=Message&#125;&#125;;</span><br><span class="line">		_ -&gt;</span><br><span class="line">		    %% Tabular data received</span><br><span class="line">		    case get_fields(LogFun, RecvPid, [], Version) of</span><br><span class="line">			&#123;ok, Fields&#125; -&gt;</span><br><span class="line">			    case get_rows(Fields, LogFun, RecvPid, []) of</span><br><span class="line">				&#123;ok, Rows&#125; -&gt;</span><br><span class="line">                    ?Log2(LogFun, debug, &quot;data: field:~p, rows:~p&quot;, [Fields, Rows]),</span><br><span class="line">                    &#123;data, #mysql_result&#123;fieldinfo=Fields,</span><br><span class="line">                            rows=Rows&#125;&#125;;</span><br><span class="line">				&#123;error, Reason&#125; -&gt;</span><br><span class="line">				    &#123;error, #mysql_result&#123;error=Reason&#125;&#125;</span><br><span class="line">			    end;</span><br><span class="line">			&#123;error, Reason&#125; -&gt;</span><br><span class="line">			    &#123;error, #mysql_result&#123;error=Reason&#125;&#125;</span><br><span class="line">		    end</span><br><span class="line">	    end;</span><br><span class="line">	&#123;error, Reason&#125; -&gt;</span><br><span class="line">	    &#123;error, #mysql_result&#123;error=Reason&#125;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>第一句do_recv主要用来对第三个参数帧序列号的不同做匹配，这里是undefined，意在接受任何帧，如果指定一个帧号A，那么do_recv只接受A+1的消息。如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> do_recv(LogFun, RecvPid, SeqNum)  when is_function(LogFun);</span><br><span class="line">				       LogFun == undefined,</span><br><span class="line">				       SeqNum == undefined -&gt;</span><br><span class="line">    receive</span><br><span class="line">        &#123;mysql_recv, RecvPid, data, Packet, Num&#125; -&gt;</span><br><span class="line">	    &#123;ok, Packet, Num&#125;;</span><br><span class="line">	&#123;mysql_recv, RecvPid, closed, _E&#125; -&gt;</span><br><span class="line">	    &#123;error, &quot;mysql_recv: socket was closed&quot;&#125;</span><br><span class="line">    end;</span><br><span class="line">do_recv(LogFun, RecvPid, SeqNum) when is_function(LogFun);</span><br><span class="line">				      LogFun == undefined,</span><br><span class="line">				      is_integer(SeqNum) -&gt;</span><br><span class="line">    ResponseNum = SeqNum + 1,</span><br><span class="line">    receive</span><br><span class="line">        &#123;mysql_recv, RecvPid, data, Packet, ResponseNum&#125; -&gt;</span><br><span class="line">	    &#123;ok, Packet, ResponseNum&#125;;</span><br><span class="line">	&#123;mysql_recv, RecvPid, closed, _E&#125; -&gt;</span><br><span class="line">	    &#123;error, &quot;mysql_recv: socket was closed&quot;&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>这个函数将端口返回的Packet和帧序号返回，或者帧序号+1返回。<br>回到<code>case do_recv(LogFun, RecvPid, undefined) of</code><br>接下来是对结果的匹配，Fieldcount为0表示执行的是update操作，而不是请求某些数据。如果为255则表示出错，返回{error, #mysql_result{error = Message}}.<br>其他数值时，会执行get_field().<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">%% Support for MySQL 4.1.x and 5.x:</span><br><span class="line">get_fields(LogFun, RecvPid, Res, ?MYSQL_4_1) -&gt;</span><br><span class="line">    case do_recv(LogFun, RecvPid, undefined) of</span><br><span class="line">	&#123;ok, Packet, _Num&#125; -&gt;</span><br><span class="line">        ?Log2(LogFun, debug, &quot;get_field: packet ~p&quot;, [Packet]),</span><br><span class="line">	    case Packet of</span><br><span class="line">		&lt;&lt;254:8&gt;&gt; -&gt;</span><br><span class="line">		    &#123;ok, lists:reverse(Res)&#125;;</span><br><span class="line">		&lt;&lt;254:8, Rest/binary&gt;&gt; when size(Rest) &lt; 8 -&gt;</span><br><span class="line">		    &#123;ok, lists:reverse(Res)&#125;;</span><br><span class="line">		_ -&gt;</span><br><span class="line">		    &#123;_Catalog, Rest&#125; = get_with_length(Packet),</span><br><span class="line">		    &#123;_Database, Rest2&#125; = get_with_length(Rest),</span><br><span class="line">		    &#123;Table, Rest3&#125; = get_with_length(Rest2),</span><br><span class="line">		    %% OrgTable is the real table name if Table is an alias</span><br><span class="line">		    &#123;_OrgTable, Rest4&#125; = get_with_length(Rest3),</span><br><span class="line">		    &#123;Field, Rest5&#125; = get_with_length(Rest4),</span><br><span class="line">		    %% OrgField is the real field name if Field is an alias</span><br><span class="line">		    &#123;_OrgField, Rest6&#125; = get_with_length(Rest5),</span><br><span class="line"></span><br><span class="line">		    &lt;&lt;_Metadata:8/little, _Charset:16/little,</span><br><span class="line">		     Length:32/little, Type:8/little,</span><br><span class="line">		     _Flags:16/little, _Decimals:8/little,</span><br><span class="line">		     _Rest7/binary&gt;&gt; = Rest6,</span><br><span class="line">		    </span><br><span class="line">		    This = &#123;Table,</span><br><span class="line">			    Field,</span><br><span class="line">			    Length,</span><br><span class="line">			    get_field_datatype(Type)&#125;,</span><br><span class="line">		    get_fields(LogFun, RecvPid, [This | Res], ?MYSQL_4_1)</span><br><span class="line">	    end;</span><br><span class="line">	&#123;error, Reason&#125; -&gt;</span><br><span class="line">	    &#123;error, Reason&#125;</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>这里提供了两个版本的get_field,我的mysql是5.5所以会匹配到这个函数上。<br>get_field一开始仍然是do_recv，用来提取一个Packet。case Packet告诉我们这个包第一个字节是254的时候表示结果已经全部告诉我们了，这时候会将Res（result）翻转，返回。<br>get_with_length用来将Packet切割，用来得到Table， Field， Length等参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">get_with_length(&lt;&lt;251:8, Rest/binary&gt;&gt;) -&gt;</span><br><span class="line">    &#123;null, Rest&#125;;</span><br><span class="line">get_with_length(&lt;&lt;252:8, Length:16/little, Rest/binary&gt;&gt;) -&gt;</span><br><span class="line">    split_binary(Rest, Length);</span><br><span class="line">get_with_length(&lt;&lt;253:8, Length:24/little, Rest/binary&gt;&gt;) -&gt;</span><br><span class="line">    split_binary(Rest, Length);</span><br><span class="line">get_with_length(&lt;&lt;254:8, Length:64/little, Rest/binary&gt;&gt;) -&gt;</span><br><span class="line">    split_binary(Rest, Length);</span><br><span class="line">get_with_length(&lt;&lt;Length:8, Rest/binary&gt;&gt;) when Length &lt; 251 -&gt;</span><br><span class="line">    split_binary(Rest, Length).</span><br></pre></td></tr></table></figure></p>
<p>这个函数的意思大致可以看出来，如果第一个字节是251，就直接返回null和Rest，如果第一个字节小于251，那么第一个字节表示长度，将Rest分割成{Value， Rest2}，Value是我们需要的，对应长度的值，如果第一个字节大于251，分不同的情况，接下来的2个4个或者8个字节表示长度，将Rest分割。举个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql:fetch(mysql_game_pool, &quot;select name from player where id = 301&quot;).</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:426) : fetch &lt;&lt;&quot;select name from player where id = 301&quot;&gt;&gt; (id &lt;0.95.0&gt;)</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:726) : get_field: packet &lt;&lt;3,100,101,102,10,97,114,105,</span><br><span class="line">                                                 101,115,95,103,97,109,101,6,</span><br><span class="line">                                                 112,108,97,121,101,114,6,112,</span><br><span class="line">                                                 108,97,121,101,114,4,110,97,</span><br><span class="line">                                                 109,101,4,110,97,109,101,12,</span><br><span class="line">                                                 33,0,150,0,0,0,253,5,64,0,0,0&gt;&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:726) : get_field: packet &lt;&lt;254,0,0,2,0&gt;&gt;</span><br><span class="line">&#123;data,&#123;mysql_result,[&#123;&lt;&lt;&quot;player&quot;&gt;&gt;,&lt;&lt;&quot;name&quot;&gt;&gt;,150,</span><br><span class="line">                      &apos;VAR_STRING&apos;&#125;],</span><br><span class="line">                    [[&lt;&lt;&quot;aaaa&quot;&gt;&gt;]],</span><br><span class="line">                    0,[]&#125;&#125;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:770) : get_rows: packet &lt;&lt;4,97,97,97,97&gt;&gt;</span><br><span class="line"></span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:770) : get_rows: packet &lt;&lt;254,0,0,2,0&gt;&gt;</span><br><span class="line">(aries_game@192.168.1.85)2&gt; </span><br><span class="line">=INFO REPORT==== 9-Jun-2015::16:43:29 ===</span><br><span class="line">I(&lt;0.94.0&gt;:mysql_conn:667) : data: field:[&#123;&lt;&lt;&quot;player&quot;&gt;&gt;,&lt;&lt;&quot;name&quot;&gt;&gt;,150,</span><br><span class="line">                                           &apos;VAR_STRING&apos;&#125;], rows:[[&lt;&lt;&quot;aaaa&quot;&gt;&gt;]]</span><br></pre></td></tr></table></figure></p>
<p>我们执行了一个sql语句，从player表中选出id为301的玩家的名字。<br>端口回复给我们的是get_field后面打印的二进制串。</p>
<ol>
<li>第一个字节是3，不是254。走get_with_length拆分。</li>
<li>将100,101,102提出，为CataLog,这个参数我们不需要。</li>
<li>10表示接下来取10个字节，一直到109，101.位Database，我们也不需要</li>
<li>接下来6，表示6个字节，&lt;&lt;112,108,97,121,101,114&gt;&gt;提取为Table，也就是我们的表名，我们在shell中打一下可以看到实际上就是&lt;&lt;”player”&gt;&gt;。表示我们是从player表取得。</li>
<li>接下来6个字节和上面一下，我们不需要。</li>
<li>下面4个字节&lt;&lt;110,97,109,101&gt;&gt;,就是&lt;&lt;”name”&gt;&gt;,表示字段名。</li>
<li>后面4个字节以上面一下，不需要。</li>
<li>从12开始一直到最后我们只需要&lt;&lt;150,0,0,0&gt;&gt;这四个表示长度,注意是小段存储，即长150，253，表示Type.</li>
<li>紧着着第一个packet到达，由于是254，告诉我们这个语句结果已返回。<br>这个时候我们只知道是player表的name字段，接下来get_rows将得到具体结果。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">get_rows(Fields, LogFun, RecvPid, Res) -&gt;</span><br><span class="line">    case do_recv(LogFun, RecvPid, undefined) of</span><br><span class="line">	&#123;ok, Packet, _Num&#125; -&gt;</span><br><span class="line">        ?Log2(LogFun, debug, &quot;get_rows: packet ~p&quot;, [Packet]),</span><br><span class="line">	    case Packet of</span><br><span class="line">		&lt;&lt;254:8, Rest/binary&gt;&gt; when size(Rest) &lt; 8 -&gt;</span><br><span class="line">		    &#123;ok, lists:reverse(Res)&#125;;</span><br><span class="line">		_ -&gt;</span><br><span class="line">		    &#123;ok, This&#125; = get_row(Fields, Packet, []),</span><br><span class="line">		    get_rows(Fields, LogFun, RecvPid, [This | Res])</span><br><span class="line">	    end;</span><br><span class="line">	&#123;error, Reason&#125; -&gt;</span><br><span class="line">	    &#123;error, Reason&#125;</span><br><span class="line">    end.</span><br><span class="line"></span><br><span class="line">%% part of get_rows/4</span><br><span class="line">get_row([], _Data, Res) -&gt;</span><br><span class="line">    &#123;ok, lists:reverse(Res)&#125;;</span><br><span class="line">get_row([Field | OtherFields], Data, Res) -&gt;</span><br><span class="line">    &#123;Col, Rest&#125; = get_with_length(Data),</span><br><span class="line">    This = case Col of</span><br><span class="line">	       null -&gt;</span><br><span class="line">		   undefined;</span><br><span class="line">	       _ -&gt;</span><br><span class="line">		   convert_type(Col, element(4, Field))</span><br><span class="line">	   end,</span><br><span class="line">    get_row(OtherFields, Rest, [This | Res]).</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>其中Field为[{&lt;&lt;”player”&gt;&gt;,&lt;&lt;”name”&gt;&gt;,150,’VAR_STRING’}],<br>与上面get_field大致相同，row的这个packet很简单，&lt;&lt;4,97,97,97,97&gt;&gt;，后面的4个字节就是我们要的结果就是&lt;&lt;”aaaa”&gt;&gt;.然后convert_type将结果转为对应的形式<br>convert_type不贴了，ｈｅｘｏ转码会有问题．<br>我们的类型是VAR_STRING，直接原样返回。<br>这样回到get_query_response，我们得到了需要的结果{data, #mysql_result{}}这种形式。<br>在往上回到init处，我们执行完&lt;&lt;”use XXX(数据库名)”&gt;&gt;, 返回成功后，执行&lt;&lt;”set names utf8”&gt;&gt;,<br>最后构造State<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">State = #state&#123;mysql_version=Version,</span><br><span class="line">					   recv_pid = RecvPid,</span><br><span class="line">					   socket   = Sock,</span><br><span class="line">					   log_fun  = LogFun,</span><br><span class="line">					   pool_id  = PoolId,</span><br><span class="line">					   data     = &lt;&lt;&gt;&gt;</span><br><span class="line">					  &#125;,</span><br><span class="line">			    loop(State)</span><br></pre></td></tr></table></figure></p>
<p>并开始loop。至此这个mysql_conn进程创建完毕。</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://youthyblog.com/2015/06/09/erlang_mysql_driver源码分析(二)/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//youthyblog.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2015/06/10/erlang_mysql_driver源码分析(三)/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/06/08/erlang_mysql_driver/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Youthy's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        Contact
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="https://weibo.com/u/1592381215" target="_blank" title="Weibo me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">person_add</i>
                        
                        Weibo me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/10/">十月 2014<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/09/">九月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/08/">八月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/07/">七月 2014<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/06/">六月 2014<span class="sidebar_archives-count">6</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/ACG/">ACG<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/erlang/">erlang<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/hexo/">hexo<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/linux/">linux<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/随笔/">随笔<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="links" title="Links">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                Links
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/shizixiuluo" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="https://weibo.com/1592381215" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    
        <a href="https://www.zhihu.com/people/yu-you-qi-46/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-zhihu">
                <span class="visuallyhidden">Zhihu</span>
            </button><!--
     --></a>
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;youthy的流水账
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//youthyblog.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->

<script type="text/ls-javascript" id="Bing-Background-script">
    queue.offer(function(){
        $('body').attr('data-original', 'https://api.i-meto.com/bing?[object Object]');
    });
</script>


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2014;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
